# agent.md

## ğŸ“¦ Project Overview
- **Name**: complete-ci-test-coverage  
- **Purpose**: å»ºç«‹å®Œæ•´çš„ CI è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹ï¼Œæ¶µè“‹å–®å…ƒæ¸¬è©¦ã€æ’ä»¶æ¸¬è©¦ã€æ•´åˆæ¸¬è©¦èˆ‡ç«¯åˆ°ç«¯æ¸¬è©¦ï¼Œç¢ºä¿æ¯æ¬¡ç¨‹å¼æ›´æ–°ä¸æœƒç ´å£æ ¸å¿ƒåŠŸèƒ½æˆ–æ’ä»¶å”ä½œï¼Œä¸¦èƒ½åŠæ—©ç™¼ç¾æ½›åœ¨å•é¡Œï¼Œç¶­æŒç³»çµ±ç©©å®šæ€§èˆ‡å“è³ªã€‚  

## ğŸ›  Tools & Permissions
- **Access scope**: Full access  

## ğŸ”„ Planning / Scheduling
- **Dependencies**:  
  - Jest (å–®å…ƒèˆ‡æ•´åˆæ¸¬è©¦æ¡†æ¶)  
  - GitHub Actions (CI pipeline åŸ·è¡Œç’°å¢ƒ)  

## ğŸ¯ Success Criteria
- Core/Utils/Tools å–®å…ƒæ¸¬è©¦å…¨ç¶ ï¼Œæ¶µè“‹ä¸»è¦é‚Šç•Œæƒ…å¢ƒï¼Œæ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%  
- æ¯å€‹ Plugin çš„å¿…è¦ä»‹é¢ï¼ˆä¾ `plugins/regulation.md` è¦ç¯„ï¼šonlineã€offlineã€restartã€stateã€sendã€updateStrategyï¼‰çš†æœ‰æ¸¬è©¦ä¸¦é€šéï¼ŒåŒ…æ‹¬ï¼š  
  - ä»‹é¢å­˜åœ¨æª¢æŸ¥  
  - åƒæ•¸é©—è­‰  
  - éŒ¯èª¤è™•ç†ï¼ˆéæ³•è¼¸å…¥ã€å…§éƒ¨ä¾‹å¤–ï¼‰  
- æ ¸å¿ƒâ†”æ’ä»¶æ•´åˆæµï¼ˆå«å¤šæ’ä»¶ä¸²è¯ï¼Œå¦‚ ASRâ†’Coreâ†’LLMâ†’Coreâ†’TTSï¼‰èƒ½åœ¨ CI ä¸­å®Œæ•´è·‘é€šï¼Œä¸¦æ–¼ä¸¦ç™¼ N=5 çš„æƒ…æ³ä¸‹ç„¡ race condition èˆ‡è³‡æºæ´©æ¼  
- ç«¯åˆ°ç«¯é—œéµç”¨ä¾‹ï¼ˆä½¿ç”¨è€…è¦–è§’ï¼‰æœ€å°‘ 2 å€‹æ¡ˆä¾‹å…¨ç¶ ï¼Œè¼¸å‡ºæ ¼å¼èˆ‡å…§å®¹ç¬¦åˆé æœŸï¼ˆå›ºå®šæ¸¬è©¦å¸³è™Ÿ/è³‡æ–™ã€ç„¡å¤–éƒ¨å¯¦é«”å‘¼å«ï¼‰  

## âš ï¸ Limits & Safeguards
- æ¸¬è©¦ç’°å¢ƒèˆ‡ç”Ÿç”¢ç’°å¢ƒåš´æ ¼éš”é›¢ï¼Œæ‰€æœ‰æ’ä»¶æ¸¬è©¦å‡ä½¿ç”¨ mock/stub æˆ–æ¸¬è©¦å°ˆç”¨é…ç½®ï¼Œé¿å…è§¸ç™¼çœŸå¯¦å¤–éƒ¨æœå‹™  
- ç«¯åˆ°ç«¯æ¸¬è©¦åªéœ€æ’°å¯«æ¸¬è©¦è…³æœ¬ï¼Œä¸¦åœ¨ CI ä¸­èˆ‡ä¸€èˆ¬æ¸¬è©¦éš”é›¢ï¼ˆé€éèª¿æ•´ `jest.e2e.config.js` é…ç½®ï¼‰ï¼Œé¿å…å› éœ€æ±‚é¾å¤§æ‹–æ…¢ pipeline  
- ä¸¦ç™¼æ¸¬è©¦åƒ…åœ¨å—æ§ç’°å¢ƒåŸ·è¡Œï¼Œé¿å…é€ æˆ CI ç¯€é»è³‡æºè€—ç›¡  
- Bug ä¿®å¾©å¿…é ˆé™„å¸¶å›æ­¸æ¸¬è©¦ï¼Œç¢ºä¿å•é¡Œä¸æœƒå†æ¬¡å‡ºç¾  

## ğŸ§ª Testing Instructions
- å–®å…ƒæ¸¬è©¦ï¼šé‡å° core/utils/tools åŸ·è¡Œ `pnpm test --filter <project>` æˆ– `pnpm jest -c jest.config.js --coverage`  
- æ’ä»¶æ¸¬è©¦ï¼šä»¥ mock/stub æ–¹å¼æ¸¬è©¦ plugin APIï¼ˆonlineã€offlineã€restartã€stateã€sendã€updateStrategyï¼‰ï¼Œé¿å…å•Ÿå‹•çœŸå¯¦æœå‹™  
- æ•´åˆæ¸¬è©¦ï¼šæ¨¡æ“¬ core èˆ‡ plugin çš„äº¤äº’ï¼ˆå«å¤šæ’ä»¶ä¸²è¯ã€éŒ¯èª¤å‚³æ’­ã€ä½µç™¼æƒ…å¢ƒï¼‰  
- ç«¯åˆ°ç«¯æ¸¬è©¦ï¼šå¾ä½¿ç”¨è€…è¼¸å…¥åˆ°æœ€çµ‚è¼¸å‡ºå…¨æµç¨‹é©—è­‰ï¼Œåƒ…ä¿ç•™å°‘é‡æ ¸å¿ƒæ¡ˆä¾‹ï¼Œä»¥ `pnpm jest -c jest.e2e.config.js --runInBand` åŸ·è¡Œ  
- CI æµç¨‹ï¼šå°‡å–®å…ƒ/æ’ä»¶/æ•´åˆ/ç«¯åˆ°ç«¯æ¸¬è©¦å…¨éƒ¨ç´å…¥ `.github/workflows`ï¼Œä»»ä½•å¤±æ•—å³é˜»æ­¢åˆä½µ  
- è¦†è“‹ç‡èˆ‡å›æ­¸æ¸¬è©¦ï¼šä¿®æ­£ bug æ™‚æ–°å¢æ¸¬è©¦æ¡ˆä¾‹ï¼Œç¶­æŒé«˜æ¸¬è©¦è¦†è“‹ç‡  

## ğŸ§‘â€ğŸ’» Dev Tips
- æ¸¬è©¦åˆ†å±¤å‘½åï¼š`*.spec.js`ï¼ˆunit/integrationï¼‰ã€`*.e2e.spec.js`ï¼ˆe2eï¼‰  
- å…©ä»½è¨­å®šï¼š`jest.config.js`ï¼ˆunit/integrationï¼Œå« `coverageThreshold: { global: { lines: 80 } }`ï¼‰èˆ‡ `jest.e2e.config.js`ï¼ˆE2Eï¼›è¼ƒé•· `testTimeout`ã€`runInBand`ã€ç¨ç«‹å ±å‘Šï¼‰  
- CI éš”é›¢ï¼š  
  - Unit/Integrationï¼š`pnpm jest -c jest.config.js --coverage --maxWorkers=50%`  
  - E2Eï¼š`pnpm jest -c jest.e2e.config.js --runInBand`  
- å¹¶ç™¼èˆ‡è³‡æºï¼šunit/integration ç”¨ `--maxWorkers=50%`ï¼›E2E ä¸€å¾‹ `--runInBand`  
- å¤±æ•—é‡è©¦ï¼šå°æ˜“å—æ™‚åºå½±éŸ¿çš„æ¡ˆä¾‹åŠ  `jest.retryTimes(2)`  
- å‡è³‡æ–™èˆ‡æ¸…ç†ï¼šä½¿ç”¨ `__fixtures__/`ï¼›æ–¼ `afterEach` æ¸…ç†æª”æ¡ˆ/é€£ç·šï¼Œé¿å…æ¸¬è©¦æ±™æŸ“  
- ç¶²è·¯éš”é›¢ï¼šé è¨­ mock `fetch`/`axios`ï¼Œç¦æ­¢çœŸå¯¦å¤–é€£ï¼›plugins æ¸¬è©¦ä»¥ stub å–ä»£å¤–éƒ¨æœå‹™  
- æ™‚é–“æ§åˆ¶ï¼š`jest.useFakeTimers()`ã€`jest.setSystemTime()` å›ºå®šæ™‚åŸº  
- æ’ä»¶ä»‹é¢å…±ç”¨æ¸¬è©¦éª¨æ¶ï¼šæª¢æŸ¥ `online/offline/restart/state/send/updateStrategy` æ˜¯å¦å­˜åœ¨ã€åƒæ•¸é©—è­‰èˆ‡éŒ¯èª¤è™•ç†  
- Monorepoï¼ˆè‹¥æœ‰ï¼‰ï¼šä»¥ Jest projects æˆ– `pnpm --filter` åˆ†æµï¼›E2E ä¿æŒç¨ç«‹å°ˆæ¡ˆ/è¨­å®š  
- CI å¿«å–ï¼šå¿«å– `node_modules` èˆ‡ `~/.cache/jest`  
- è³‡è¨Šå¯è§€æ¸¬æ€§ï¼šæ¨™æº–åŒ– `console.error` æ””æˆªèˆ‡çµæ§‹åŒ–æ—¥èªŒè¼¸å‡ºï¼ˆå¤±æ•—æ™‚å¸¶ä¸Š plugin åç¨±ã€è«‹æ±‚ IDã€æ¸¬è©¦æ¡ˆä¾‹åï¼‰ï¼Œæ–¹ä¾¿æ’æŸ¥  

## ğŸ“ PR Example
```
- **PR Title**: [complete-ci-test-coverage] è£œå……å®Œæ•´çš„ CI æ¸¬è©¦è¦†è“‹ç‡  
- **PR Description**: Project purpose: å»ºç«‹å®Œæ•´çš„ CI è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹ï¼Œæ¶µè“‹å–®å…ƒæ¸¬è©¦ã€æ’ä»¶æ¸¬è©¦ã€æ•´åˆæ¸¬è©¦èˆ‡ç«¯åˆ°ç«¯æ¸¬è©¦ï¼Œç¢ºä¿æ›´æ–°ä¸ç ´å£æ ¸å¿ƒåŠŸèƒ½èˆ‡æ’ä»¶å”ä½œ

Tools/Permissions: ä½¿ç”¨ Jest èˆ‡ GitHub Actionsï¼ŒFull access æ¬Šé™

Success Criteria:

Core/Utils/Tools æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%

Plugins æ¥å£ï¼ˆonline/offline/restart/state/send/updateStrategyï¼‰çš†æœ‰æ¸¬è©¦é€šé

æ ¸å¿ƒâ†”æ’ä»¶æ•´åˆæµèˆ‡å¤šæ’ä»¶ä¸²è¯èƒ½å®Œæ•´åŸ·è¡Œï¼Œä¸¦ç™¼ N=5 ç„¡ race condition

è‡³å°‘ 2 å€‹ç«¯åˆ°ç«¯ç”¨ä¾‹é©—è­‰æˆåŠŸï¼Œè¼¸å‡ºæ ¼å¼èˆ‡å…§å®¹ç¬¦åˆé æœŸ

Limits/Safeguards:

æ¸¬è©¦ç’°å¢ƒèˆ‡ç”Ÿç”¢éš”é›¢ï¼Œæ’ä»¶æ¸¬è©¦ä½¿ç”¨ mock/stub

E2E æ¸¬è©¦ä»¥ç¨ç«‹è…³æœ¬èˆ‡ jest.e2e.config.js åŸ·è¡Œï¼Œé¿å…å¹²æ“¾ä¸€èˆ¬æ¸¬è©¦

å¹¶ç™¼æ¸¬è©¦åƒ…æ–¼å—æ§ç’°å¢ƒé€²è¡Œ

Bug ä¿®å¾©éœ€é™„å¸¶å›æ­¸æ¸¬è©¦
```